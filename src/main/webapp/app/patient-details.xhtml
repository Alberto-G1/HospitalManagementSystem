<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template.xhtml">

    <f:metadata>
        <f:viewParam name="id" value="#{patientDetailBean.patientId}" required="true" converter="jakarta.faces.Integer"/>
        <f:viewAction action="#{patientDetailBean.loadPatient}"/>
    </f:metadata>

    <ui:define name="pageTitle">Patient Details</ui:define>

    <ui:define name="content">
        <h:form id="form">
            <div class="card" rendered="#{not empty patientDetailBean.patient}">
                <p:toolbar>
                    <p:toolbarGroup>
                        <p:button value="Back to List" icon="pi pi-arrow-left" outcome="patients" styleClass="ui-button-secondary"/>
                    </p:toolbarGroup>
                </p:toolbar>

                <div class="p-grid" style="margin-top:20px;">
                    <div class="p-col-12 p-md-4">
                        <p:panel header="Patient Information">
                            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank">
                                <h:outputText value="Name:" styleClass="font-bold"/>
                                <h:outputText value="#{patientDetailBean.patient.firstName} #{patientDetailBean.patient.lastName}"/>
                                <h:outputText value="Date of Birth:" styleClass="font-bold"/>
                                <h:outputText value="#{patientDetailBean.patient.dateOfBirth}"><f:convertDateTime type="localDate" pattern="dd MMMM, yyyy"/></h:outputText>
                                <h:outputText value="Gender:" styleClass="font-bold"/>
                                <h:outputText value="#{patientDetailBean.patient.gender}"/>
                                <h:outputText value="Phone:" styleClass="font-bold"/>
                                <h:outputText value="#{patientDetailBean.patient.phoneNumber}"/>
                                <h:outputText value="Email:" styleClass="font-bold"/>
                                <h:outputText value="#{patientDetailBean.patient.email}"/>
                                <h:outputText value="Address:" styleClass="font-bold"/>
                                <h:outputText value="#{patientDetailBean.patient.address}"/>
                                <h:outputText value="Emergency Contact:" styleClass="font-bold"/>
                                <h:outputText value="#{patientDetailBean.patient.emergencyContact}"/>
                            </p:panelGrid>
                        </p:panel>
                    </div>
                    <div class="p-col-12 p-md-8">
                        <p:panel header="Medical History Summary">
                            <h:outputText value="#{patientDetailBean.patient.medicalHistory}" style="white-space: pre-wrap; line-height: 1.8;"/>
                        </p:panel>
                    </div>
                </div>

                <p:tabView style="margin-top:20px;">
                    <p:tab title="Medical Records (#{patientDetailBean.medicalRecords.size()})">
                        <p:dataTable var="record" value="#{patientDetailBean.medicalRecords}" emptyMessage="No medical records found.">
                            <p:column headerText="Visit Date"><h:outputText value="#{record.visitDate}"><f:convertDateTime type="localDateTime" pattern="dd MMM yyyy, h:mm a"/></h:outputText></p:column>
                            <p:column headerText="Doctor">Dr. #{record.doctor.lastName}</p:column>
                            <p:column headerText="Diagnosis">#{record.diagnosis}</p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Appointments (#{patientDetailBean.appointments.size()})">
                        <p:dataTable var="appt" value="#{patientDetailBean.appointments}" emptyMessage="No appointments found.">
                            <p:column headerText="Date"><h:outputText value="#{appt.date}"/></p:column>
                            <p:column headerText="Doctor">Dr. #{appt.doctor.lastName}</p:column>
                            <p:column headerText="Status"><p:tag value="#{appt.status}"/></p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>
            </div>
        </h:form>
    </ui:define>

</ui:composition>